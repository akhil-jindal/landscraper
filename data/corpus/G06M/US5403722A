Technique to count objects in a scanned image 
US-5403722-A
Minnesota Mining And Manufacturing Company
1995-04-04
https://patents.google.com/patent/US5403722A/en
This is a continuation of application Ser. No. 07/912,887, filed Jul. 13, 1992, now abandoned.
FIELD OF THE INVENTION
This invention relates to a method and apparatus for counting the number of distinct objects in a scanned image. In particular, it relates to a method and apparatus for counting the number of microorganism colonies present on a substantially planar substrate.
BACKGROUND OF THE INVENTION
Different methods and devices are known for counting microorganism colonies in, for example, petri dishes. Manual counting of colonies by trained laboratory personnel is well-known. This method has many disadvantages. They include the costs associated with the use of skilled technicians to perform the time-consuming chore of manual counting as well as the limited accuracy in the counts achieved.
Automated counting systems are also known. They can be separated into two basic categories. The first category includes those systems employing cameras or video equipment in conjunction with hard-wired circuits or digital computers to count the number of colonies in a petri dish. Examples of such systems are described in EP Publication No. 0 301 600; U.S. Pat. No. 3,811,036 to Perry; and French Publication No. 2 602 074.
Video-based systems suffer from a number of disadvantages. The primary disadvantage is the expensive and sophisticated equipment used in such systems to process the raw pixel image produced by the video cameras. To avoid multiple counting of the same colonies such systems typically include processing-intensive labelling schemes requiring relatively powerful computer systems to accurately count of the number of colonies in an acceptable amount of time.
An additional disadvantage is that many of these video-based systems require that the petri dishes be illuminated through their bottom surface which requires a substrate which is light permeable to ensure accurate counting. The illumination is typically required because of the thickness of the agar used in petri dishes results in colonies growing on the surface of the agar as well as in the middle and on the bottom of the agar. Surface illumination only would result in undercounting of the colonies in the middle and on the bottom of the agar. In other systems, such as that described in EP 0 301 600, the absorbance and transmission of light is used to detect colonies.
The growth of colonies throughout the vertical thickness of the medium is not a particular problem for lasers of the disposable microorganism culturing devices such as PETRIFILMâ¢, manufactured by 3M Company. Such devices have a very thin layer of growth medium making all colonies visible with surface illumination. The substrate is not, however, sufficiently permeable to light for use with many of the known automated counting systems.
In addition to the cost and complexity of the hardware configurations of known automated video counting systems, the object counting algorithms used with systems employing digitization of the images also suffer from disadvantages.
A simple Euler number can be used to identify objects in a raster-scanned image and can be used with only a single pass through the image, but detects only 4-connected objects. This can give spurious results when 8-connected images are present in the scanned image.
At the opposite extreme, a full-connected component analysis detects all objects, whether they are 4-connected or 8-connected. That type of analysis, however, involves complicated-labeling and tagging operations which can require multiple passes through the image, as well as significantly more complex and costly hardware.
The second category of automated counting systems typically uses an array of photodetectors and hard-wired circuitry to perform the counting process. As with most of the video-based systems, the counting systems using photodetectors are also limited by the requirement that the petri dish be illuminated through its substrate to produce an accurate count. As a result, the substrate on which the colonies are contained must be light permeable, which is a particular problem with disposable culturing devices such as PETRIFILMâ¢.
Examples of such systems are disclosed in U.S. Pat. No. 3,493,772 to Daughters II et al. as well as U.S. Pat. No. 3,736,432 to Sweet. The Daughters' device includes a light source located below the petri dish and uses the colonies as lenses to focus the light on a linear array of photodetectors. The Sweet device employs a light source below the petri dish which uses the light absorbency of the bacterial colonies to produce dark spots on a linear photo detector. Both systems use dedicated circuitry to perform the counting process.
The Daughters and Sweet devices both use a linear array of photodetectors and rely on voltage changes to inhibit counting by neighboring photodetectors, thereby avoiding multiple counting of individual colonies. That circuitry can cause errors in counting because colonies which may or may not be opaque or light permeable may not be counted with a given system. Other errors can occur in the counting of tree-shaped or other complex shaped colonies.
SUMMARY OF THE INVENTION
The present invention provides significant advantages over known automated counting systems. Primary among those advantages is that the preferred apparatus is developed specifically for use with disposable devices for culturing microorganisms as described in U.S. Pat. No. 4,565,783 to Hansen et al., which is hereby incorporated by reference.
Commercial embodiments of the devices described in Hansen are marketed under the tradename PETRIFILMâ¢ by 3M Company. Many PETRIFILMâ¢ products include substrates which are not substantially light permeable and, therefore, render many of the previously known devices for counting colonies in standard petri dishes unusable. In addition, many of those systems are adapted for use with standard petri dishes having a deep well to hold the culturing medium, not the substantially planar PETRIFILMâ¢ products.
The present invention eliminates the disadvantages of the known systems as described above. In particular, the present invention does not require illumination through the substrate and is adapted for use with microorganism culturing devices having a substantially planar substrate, such as PETRIFILMâ¢. The present invention also provides a fast and accurate count of colonies using readily available linear arrays of light sources, lenses and image sensors--many of which were developed for use in facsimile or photocopying machines. These components are connected to readily available microprocessors and use the algorithm described below to accurately and quickly perform the counting process without labelling or long-term storage of the data to avoid multiple counting of individual colonies.
In its simplest form, the preferred apparatus of the present invention includes a LED bar illuminating the surface of the substrate and a linear array of SELFOC lenses which focus the light reflected off of the substrate onto a linear CCD sensor array. The CCD sensor array is connected to a microprocessor which analyzes the raster-scanned data using the preferred algorithm.
In the preferred embodiment, the apparatus is electrically connected to a remote computer for automatic data transfer and storage.
The preferred image processing system includes an automatic calibration feature which calibrates the sensors by scanning a blank substrate to determine a threshold level above which objects will be counted.
Also contemplated for use in the present invention is a cassette mechanism to automatically feed a number of substrates through the scanning apparatus in a manner similar to the automatic feeding of paper through a photocopying machine.
Barcode labels can also be incorporated into the culturing devices to simplify the transfer of information from the preferred apparatus to other electronic equipment. In the preferred apparatus, the LED array and CCD sensors used to detect colonies are also used to read the barcode labels.
The preferred algorithm developed for use with the present invention also offers advantages not available with known object counting algorithms. Like an Euler number analysis, the preferred algorithm can be used with only a single pass through the image. Its advantage over the Euler number analysis is that the preferred algorithm can detect 8-connected objects in addition to the 4-connected images to which a Euler number analysis is limited. The preferred algorithm does so without requiring multiple passes through the image or the complexity and cost associated with a full-connected component analysis algorithm including labeling of the pixels from the entire image.
In addition, the preferred algorithm is particularly useful for inspection tasks requiring relatively high image processing speeds because its use of raster-scanned data and limited processing neighborhood are tailored for high speed data processing using relatively simple hardware. In contrast, the known systems described above require complex hardware configurations to implement complex data analysis schemes. As a result, they typically cost $10,000 or more.
These and various other advantages and features which characterize the present invention are pointed out witch particularity in the claims annexed hereto and which form a part hereof. However, for a better understanding of the invention, its advantages, and the objects obtained by its use, reference should be made to the .drawings which form a further part hereof, and to the accompanying descriptive matter, in which there are illustrated and described preferred embodiments of the invention.
BRIEF DESCRIPTION OF THE DRAWINGS
FIG. 1 is a cross-sectional side view of the present invention, illustrating the relationship between the components of the preferred embodiment.
FIG. 2 is a top perspective view of a disposable microorganism culturing device such as PETRIFILMâ¢ having a number of colonies located thereon.
FIG. 3 is an enlarged cross-sectional side view of the scanning area of the preferred apparatus.
FIG. 4 is a block diagram illustrating the control system of the present invention.
FIG. 5 is a flow chart depicting operation of a preferred embodiment of the present invention.
FIG. 6 is a diagram of the pixel region used in the preferred algorithm of the present invention.
FIG. 7 is a table illustrating the 16 possible pixel regions used in processing image data in the preferred algorithm of the present invention.
FIG. 8 is a table of examples of possible objects encountered by the present algorithm and the outcome of the preferred algorithm after processing these objects.
DESCRIPTION OF THE PREFERRED EMBODIMENTS
FIG. 1 depicts the preferred apparatus of the present invention in a cross-sectional view for clarity. This preferred apparatus of the present invention is designed for counting the number of microorganism colonies on disposable culturing devices such as PETRIFILMâ¢ (see FIG. 2), although objects on any substrate could be counted using appropriate modifications to the hardware and control systems. One example of another application is the inspection of moving webs for defects that occur as distinct objects.
FIG. 2 depicts a disposable microorganism culturing device 40, such as the PETRIFILMâ¢ product described above. The device includes a substrate 42 having microorganism colonies 44 located on its surface. In a preferred embodiment, the substrate 40 also preferably includes a barcode 46 at its upper edge for identifying individual samples. The barcode is particularly useful for tracking storage and transfer of data. PETRIFILMâ¢ products also typically include a series of grid lines 48 which are useful for manual counting of colonies. Although the preferred apparatus is designed for use with PETRIFILMâ¢ products, it will be understood that any similar product having a substantially planar substrate with nutrients adhered to its surface for the culturing of microorganisms could be used in place of PETRIFILMâ¢ products.
FIG. 1 depicts a preferred embodiment of the present invention. The counter 10 includes a motor 12 which is preferably a DC stepping motor. Motor 12 is operably connected to rollers 14a, 14b and 16 to move a substrate 26 through counter 10 for scanning. The substrate 26 enters the counter 10 on the right and moves through to the left end of the apparatus. A stepping motor is used to provide accurate incremental movement of the substrate 26 through the counter 10.
The preferred counter 10 includes a linear LED array 20 aimed at the substrate 26. The preferred LED array is Model No. TLG6A13P manufactured by Toshiba Corporation. This LED array is particularly useful because it produces light in wavelengths that neutralize the grid array 48 present on one version of the PETRIFILMâ¢ product (see FIG. 2). That grid array is yellow to the naked eye. A similar effect could be duplicated with light sources producing other wavelengths by using a reddish-yellow filter (Wratten filter #9 or Corion LL-550-S-4385) between the CCD sensor 24 and light source.
The preferred LED array 20 is also useful for the present application because the intensity of the light produced across the array is substantially uniform which aids in the accuracy of the apparatus.
Located above substrate 26 in the preferred counter is linear array of SELFOC lenses 22, Model No. SLA-12-TC43A6, manufactured by Nippon Sheet Glass Co. This rod lens array 22 is widely used in facsimile machines as well as some photocopying equipment. Above the SELFOC lens array is a linear CCD sensor array 24, preferably Model No. TCD127AC, manufactured by Toshiba Corporation.
FIG. 3 is an enlarged view of the scanning area of the preferred apparatus. As shown there, LED array 20 produces light 21 which reflects off of substrate 26 and is at least partially reflected through the SELFOC lens 22 which focuses the light on the CCD image sensor 24. Rollers 14a and 14b are used move the substrate 26 through the scanning area. As discussed above, the rollers are preferably connected to stepping motor 12 for accurate incremental movement of the substrate 26 through the scanning area.
Also depicted in FIG. 1, the input end of the counter 10 is adapted to receive a cassette 18 which holds a stack of substrates 26 for automatic feeding through the counter 10. Roller 16 is placed above the cassette mechanism 18 and rests on the topmost substrate 26 to automatically feed it into the counter 10.
FIG. 4 is a block diagram illustrating the preferred control system of the present invention. As illustrated, the CCD image sensor 24 is connected to the microprocessor 50. The preferred microprocessor 50 is an 8-Bit CMOS Microcontroller, Model No. 80C535, manufactured by Siemens AG.
Data from the CCD image sensor 24 is stored in the image memory 60 also connected to the microprocessor 50. In the preferred embodiment, this data is produced in a raster-scanned format for use with the preferred algorithm as discussed in more detail below.
The LCD display 30 is used to provide messages to the operator and prompt actions by the same. The cassette switch 52 is used to indicate whether a cassette 18 (see FIG. 1) is loaded in the counter 10. The start key 54 is used to begin the process of moving a substrate 26 into the scanning area and performing the scanning process. The input light switch 56 is used to indicate whether a substrate 26 has been moved into the scanning area.
The stepping motor 12 is used to incrementally advance substrates 26 through the scanning area and out of the counter and is operably connected to the rollers 14a, 14b and 16 shown in FIGS. 1 & 3. The rollers are preferably gear-driven, although any suitably accurate connection method can be used.
The LED bar array 20 is used to illuminate the surface of the substrate 26 and any objects on it for sensing by the CCD image sensor 24. The CCD image sensor 24 is used to detect objects from the reflected light. The image sensitivity circuit 58 is used to adjust sensitivity of the CCD image sensor 24 to a level below which a blank substrate 26 will not trigger the image sensor. An advantage of this circuit is that it automatically adapts to variations in the background presented by different substrates.
The image memory 60 is used to store data from the CCD image sensor 24 and is used to detect the number of distinct objects on the surface of the substrate 26 using the preferred algorithm described below. The RS-232 serial interface 62 is used to provide communication between the present invention and a computer or other electronic device. As shown in FIG. 1, the counter 10 is preferably connected to a computer 32 via the RS-232 interface to allow transfer of data between the computer and the counter 10.
FIG. 5 is a flowchart showing operation of the preferred embodiment of the present invention which includes a cassette to automatically feed substrates into the counter 10. It will be understood by those skilled in the art that features of this flowchart would not be applicable to a counter designed to scan individually-fed substrates.
To begin the process, the counter 10 is powered up 70 and the LCD display indicates that a cassette containing a number of substrates should be loaded into the counter with a blank (empty) substrate placed on top 72. The blank substrate is used to adjust the sensitivity of the CCD image sensors in order to avoid errors in the detection process. Once cassette is loaded, the LCD display reads "Press Start Key" 76.
After Start Key is activated, the empty substrate is moved into the center of the counter 80, also referred to above as the scanning area. The counter also preferably includes an input light switch which indicates that a substrate has actually been moved into the scanning area 82. If no substrate (or film) is present the LCD display would read "Jam" or "No Film" 84 to indicate to the operator that an error in operation had occurred.
Once an empty substrate is in position the scanning process begins. If the blank substrate generates a signal from the CCD image sensor 86, the image sensitivity circuit automatically decreases sensitivity of the CCD image sensor 88 to a point at which no signal is generated from the empty substrate.
After the CCD image sensor sensitivity is set, the empty substrate is moved out of the counter 90 and the first substrate with microorganism colonies is moved into position for scanning 92. The first line would then be scanned into memory 94 and if that line included a barcode, the barcode would be placed into memory indicating the identity of the sample located on the substrate 96.
The substrate is then moved into the scanning area (data position) 98 and the first line of data is scanned into the image memory 100. The substrate (film) is moved one step by the stepper motor 102 and the next line is scanned into memory 104. The memory contents are then analyzed 106 according to the preferred algorithm described below. Scanning continues in this stepwise fashion until the entire substrate is scanned 108.
After the scanning is finished, the results of the scanning process are displayed 114 and could be transferred to a computer or other electronic device using the RS-232 serial interface which is a part of the preferred embodiment of the present invention. The controller determines if an additional substrate is available in the cassette 116 and, if so, the above process is repeated. After all the substrates in the cassette have been scanned, the counter 10 signals that the process is complete.
Although the preferred apparatus as described above includes an LED array producing light with a peak wavelength of 567 nm, it will be understood that many other types or methods of detection other than those discussed above are also possible. In particular, the present invention could use light sources that are fluorescent or the CCD image sensors could be used to detect chemiluminescent colonies. In addition, the detectors could be sensitive to specific colors or could detect radiation emanating from colonies.
Also, although the preferred embodiment of the apparatus includes the hardware described above, alternate embodiments can be developed using other hardware. Because the data from the line scanners is in raster-scanned format, a simple line delay device (e.g., several FIFO's strung together or static RAM with independent read/write address hardware) will provide access to two lines of the raster-scanned image. A shift register and a bank of comparators can then determine the bit pattern triggering the object start and object merge conditions described in more detail below. Alternatively, a shift register output can be directly used as the address of data into a lookup table. Summing hardware could then count the number of object start and object merge conditions detected by either the lookup table or by the comparators.
PREFERRED OBJECT COUNTING ALGORITHM
The preferred algorithm for counting the number of distinct objects in the scanned area of the substrate is described below, with reference to FIGS. 6-8. In essence, the algorithm searches the data stream to detect object starts and object merges. The total number of distinct objects in a scanned image is equal to the number of object starts minus the number of object merges.
It will be understood by those skilled in the art that many other algorithms could be used to scan objects such as substrates having microorganism colonies located on them. Examples of algorithms include the SRI (Stanford Research Institute) algorithm or an Euler number analysis. The present invention is, however, most advantageously used with the preferred algorithm described below.
The preferred algorithm is designed for use with a raster-scanned data format to provide high speed inspection capabilities. That format treats the image as a two-dimensional array of data which may only be accessed along successive rows in a left-to-right manner. As a result, it is difficult to access more than a small portion of the image at any single time. The pixel of interest passes through the image in a raster scanned manner and, thus, the portion of the image available for processing must also pass through the image with the pixel of interest.
The preferred algorithm uses the sigma-shaped neighborhood depicted in FIG. 6 for image processing. The addition of the fifth pixel (P3) to the standard 2Ã2 processing neighborhood allows for 8-connected object analysis not available with a Euler number analysis. Also, because any given pixel is either part of an object or part of the background, grey level images are preferably converted to binary format where the object is white (pixel value=1) and the background is black (pixel value=0). That conversion is accomplished before the data is processed with the preferred algorithm.
In use, the algorithm passes the sigma region across the image in a raster-scanned Order so that pixel P1, the pixel of interest, is centered on each pixel in the image exactly once (appropriate delay lines may be necessary if pipeline operation is desired).
With only five pixels in the sigma region there are only 32 possible combinations of image data in a binary system. Of the 32 combinations, only those in which P1=1 are part of an object. If pixel P1=0, then it is part of the background and is not applicable for counting. Only 16 of the possible 32 combinations satisfy the above condition. These 16 combinations are depicted in FIG. 7.
In this group of patterns, only four are used in the preferred algorithm. They break down further into a "Start Condition" 130 and three "Merge Conditions" 132, as depicted in FIG. 7. The Start Condition 130 has a binary value of 10000, while the three Merge Conditions 132 have values of 10101, 11001 & 11101.
The preferred algorithm is based on the principle that any object in the scanned image must have a starting place. That condition is most easily seen with the Start Condition 130 which represents the first pixel of an object as viewed in the raster-scanned data format. Problems arise, however, because a single distinct object may have several pixels whose neighborhoods match the starting case. A tree-like object may have multiple branches, each with unique pixels matching the Start Condition and which eventually "merge" into a single object.
The preferred algorithm relies on the three unique Merge Conditions to prevent multiple counting of a single distinct object. The Merge Conditions occur when seemingly distinct objects combine to form a single distinct object. Those Merge Conditions 132 are illustrated in FIG. 7.
In the counting process, the data stream is searched to detect an object start (Start Condition) whenever P1=1 and P2-P5 all equal 0 (rendering the binary data stream 10000) and an object is added to the object sum. Likewise, the data stream is also searched for any of the three object merges (Merge Conditions). When an object merge is detected, an object is subtracted from the object sum. Thus, the final object sum is the sum of all the object starts found less all of the object merges.
Because of the small sigma-shaped processing neighborhood and the use of object merges to adjust for multiple counting, the preferred algorithm is global in nature, i.e., a final object sum is not available until the entire image is scanned and processed.
It should be noted that the preferred algorithm is not perfect. Complex shapes can be miscounted with the final object sum tending to be lower than the actual number of distinct objects found in the image. Referring to FIG. 8, examples of some possible complex shapes is illustrated along with an analysis of how the preferred algorithm would count these shapes. In particular, the preferred algorithm will typically fail to count objects having holes in them, two of which are illustrated as objects 134 and 136.
In spite of this failing, the preferred apparatus and algorithm provide colony counts that are well within the allowed margin of error as compared to manual counting. In addition, the preferred method of use includes manual screening of the substrates prior to automated counting to remove those substrates in which the colonies have merged to form a global colony which would likely be miscounted by the present invention.
That failure exists because, for any given merge condition, the algorithm cannot discern whether the two branches surrounding the hole are distinct or if they had split from a single object farther above in the image. This problem cannot be remedied without a complicated and expensive global object labeling feature which defeats many of the advantages accompanying the preferred algorithm and apparatus. In spite of this drawback, the present algorithm does count the vast majority of objects with sufficient accuracy to be very useful in many image processing tasks.
It is to be understood, however, that even though numerous characteristics and advantages of the present invention have been set forth in the foregoing description, together with details of the structure and function of the invention, the disclosure is illustrative only, and changes may be made in detail, especially in matters of shape, size and arrangement of parts within the principles of the invention to the full extent indicated by the broad general meaning of the terms in which the appended claims are expressed.